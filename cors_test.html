<!DOCTYPE html>
<html>
<body>
    <h1>CORS Test</h1>
    <div id="output">Running...</div>
    <script>
        function jsonpFetch(url) {
            return new Promise((resolve, reject) => {
                const callbackName = 'jsonp_' + Math.round(100000 * Math.random());
                const script = document.createElement('script');
                
                window[callbackName] = (data) => {
                    delete window[callbackName];
                    document.body.removeChild(script);
                    resolve(data);
                };

                script.src = `${url}&callback=${callbackName}`;
                script.onerror = () => {
                    delete window[callbackName];
                    document.body.removeChild(script);
                    reject(new Error('JSONP Request Failed'));
                };
                
                document.body.appendChild(script);
            });
        }

        async function test() {
            try {
                const data = await jsonpFetch('https://itunes.apple.com/search?term=adele&entity=song');
                document.getElementById('output').innerText = 'SUCCESS: ' + JSON.stringify(data.results[0]);
            } catch (e) {
                document.getElementById('output').innerText = 'ERROR: ' + e.message;
            }
        }

        test();
    </script>
</body>
</html>
